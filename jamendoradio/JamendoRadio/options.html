<html>
<head>
    <title>Jamendo Radio Configuration</title>
    <script type="text/javascript">
        function save_options() {
            var settingsTable = document.getElementById("settingsTable");
            var options = new Array();

            for (i = 0; i < settingsTable.rows.length; i++) {
                var cell = settingsTable.rows[i].children[1];
                var name = cell.firstChild.value;

                cell = cell.nextSibling;
                var subset = cell.firstChild.value;

                if (name && subset)
                    options[options.length] = { "Name": name, "Subset": subset };
            }

            localStorage["Stations"] = JSON.stringify(options);
            localStorage["SiteIntegration"] = JSON.stringify(document.getElementById("pageIntegration").checked);
        }
        function restore_options() {
            var stations = eval(localStorage["Stations"]);
            if (!stations || stations.length == 0) { populateDefault(); }

            for (i = 0; i < stations.length; i++) {
                AddRow(stations[i].Name, stations[i].Subset);
            }

            document.getElementById("pageIntegration").checked = eval(localStorage["SiteIntegration"]);
        }
        function populateDefault() {
            AddRow("Rock", "tag_idstr=rock");
            AddRow("Piano", "album_id=29114+29279+888+2007+53704+55571+36218+889");
            AddRow("Trance", "artist_idstr=subatomicglue+psydom+nexus+red.nebula+secret.side+xl.ant+six");
        }

        function AddRow(name, subset) {
            var settingsTable = document.getElementById("settingsTable");

            var newRow = document.createElement("tr");
            var nameCell = document.createElement("td");
            var nameEditor = document.createElement("input");
            var subsetCell = document.createElement("td");
            var subsetEditor = document.createElement("input");
            var controlCell = document.createElement("td");
            var controlButton = document.createElement("img");

            controlButton.onclick = function () { settingsTable.removeChild(newRow); };
            controlButton.src = "Images/trash.png";
            controlCell.appendChild(controlButton);

            if (name)
                nameEditor.value = name;
            if (subset)
                subsetEditor.value = subset;

            nameCell.appendChild(nameEditor);
            subsetCell.appendChild(subsetEditor);


            newRow.appendChild(controlCell);
            newRow.appendChild(nameCell);
            newRow.appendChild(subsetCell);


            settingsTable.appendChild(newRow);
        }
        function RemoveRow(index) {
            var settingsTable = document.getElementById("settingsTable");
        }
        function AddStation() {
            if (!newSet.value && !newOrder.value) { alert("Please specify sort order"); return; }
            if (newSet.value && !newValues.value) { alert("Please specify criteria"); return; }
            if (!newName.value) { alert("Please pick a name for this station"); return; }
            if (newValues.value && newValues.value.indexOf(' ') > -1) { alert("Criteria may not contain spaces.\nSeparate them by placing one on each row..."); return; }

            var order = "";
            var set = "";

            if (newSet.value) set = newSet.value + "=" + newValues.value.replace(/\n/mg, '+');
            if (newOrder.value) order = "order=" + newOrder.value;

            var subset;
            if (set && order) set += "&";
            AddRow(newName.value, set + order);

            designer.className = 'hidden';
        }
    </script>
    <style type="text/css">
        thead tr
        {
            border-bottom: 1px solid black;
        }
        input
        {
            width: 95%;
        }
        dt, dd
        {
            display: inline-block;
            margin: 0;
            padding: 0;
        }
        dt
        {
            width: 30%;
            font-weight: bold;
        }
        dd
        {
            width: 60%;
        }
        textarea
        {
            vertical-align: text-top;
            width: 95%;
        }
        .hidden
        {
            display: none;
        }
    </style>
</head>
<body onload="restore_options()">
    <h1>
        General settings</h1>
    <input type="checkbox" id="pageIntegration" style="width: 75px;" />Integrate with
    jamendo.com
    <h1>
        Channel setup</h1>
    <table style="width: 100%;">
        <thead>
            <tr>
                <td style="width: 20px;">
                    &nbsp;
                </td>
                <td style="width: 250px;">
                    Name
                </td>
                <td>
                    Subset
                </td>
                <td>
                </td>
            </tr>
        </thead>
        <tbody id="settingsTable">
        </tbody>
    </table>
    <br />
    <div id="designer" style="border: 1px solid black; position: absolute; top: 30%;
        padding: 10px; left: 50%; width: 300px; margin-left: -150px; background: white;"
        class="hidden">
        <dl>
            <dt>Name</dt>
            <dd>
                <input id="newName" /></dd>
            <dt>Selection</dt>
            <dd>
                <select id="newSet" onchange="newValues.disabled = this.selectedIndex == 0">
                    <option value="">Everyting</option>
                    <option value="tag_idstr">Tag(s)</option>
                    <option value="artist_idstr">Artist(s)</option>
                    <option value="album_id">Album(s)</option>
                </select>
            </dd>
            <dt>Criteria</dt>
            <dd>
                <textarea id="newValues" rows="6" cols="25" disabled="disabled" onblur="this.value = this.value.replace(/\n+/, '\n').replace(/\n*$/, '');"></textarea></dd>
            <dt>Sorting</dt>
            <dd>
                <select id="newOrder">
                    <option value="">No sorting</option>
                    <option value="releasedate">Release date</option>
                    <option value="rating">Rating</option>
                    <option value="ratingweek">Rating (weekly)</option>
                    <option value="ratingmonth">Rating (monthy)</option>
                    <option value="playlisted">Playlisted</option>
                    <option value="downloaded">Downloaded</option>
                    <option value="listened">Listened</option>
                    <option value="starred">Favourited</option>
                </select>
            </dd>
        </dl>
        <div style="text-align: center;">
            <button id="clearDesigner" onclick="newName.value = newSet.value = newValues.value = newOrder.value = '';newValues.disabled = true">
                Clear</button>
            <button onclick="AddStation();">
                Add station</button>
            <button onclick="designer.className='hidden'">
                Cancel</button>
        </div>
    </div>
    <button onclick="AddRow();">
        Add new row</button>
    <button onclick="clearDesigner.click();designer.className = '';">
        Open channel designer</button>
    <button onclick="save_options()">
        Save</button>
    <div style="float: right">
        Project <a href="http://code.google.com/p/jamendoradio/">home page</a>.
    </div>
</body>
</html>
