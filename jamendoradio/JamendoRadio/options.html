<html>
<head>
    <title>Jamendo Radio Configuration</title>
	<script src="Theme/jquery-1.3.2.min.js"></script>
	<script src="Theme/jquery-ui-1.7.2.custom.min.js"></script>
    <script type="text/javascript">
        function save_options() {
            var settingsTable = document.getElementById("settingsTable");
            var options = new Array();
			$("tbody > tr").each(function() { options[options.length] = { "Name":this.children[1].children[0].value, "Subset": this.children[2].children[0].value }; });
			
            localStorage["Stations"] = JSON.stringify(options);
            localStorage["SiteIntegration"] = JSON.stringify(document.getElementById("pageIntegration").checked);
            localStorage["SkipDefault"] = JSON.stringify(document.getElementById("skipDefault").checked);
		}
		
        function restore_options() {
            var stations = eval(localStorage["Stations"]);
            if (!stations || stations.length == 0) { populateDefault(); }

            for (i = 0; i < stations.length; i++) {
                AddChannel(stations[i].Name, stations[i].Subset);
            }

            document.getElementById("pageIntegration").checked = eval(localStorage["SiteIntegration"]);
			document.getElementById("skipDefault").checked = eval(localStorage["SkipDefault"]);
        }
        function populateDefault() {
            AddChannel("Rock", "+album_tag/?tag_idstr=rock&order=ratingweek_desc");
            AddChannel("Piano", "/?order=random&album_id=29114+29279+888+2007+53704+55571+56448");
            AddChannel("Psytrance", "/?order=random&artist_idstr=subatomicglue+psydom+nexus+red.nebula+secret.side+xl.ant+six");
        }
		
		function sformat(inString, v1, v2, v3, v4, v5, v6, v7, v8, v9, v10) {
			return inString.replace(/{(\d)}/g, function(m) { 
				switch(m) {
					case "{0}": return v1;
					case "{1}": return v2;
					case "{2}": return v3;
					case "{3}": return v4;
					case "{4}": return v5;
					case "{5}": return v6;
					case "{6}": return v7;
					case "{7}": return v8;
					case "{8}": return v9;
					case "{9}": return v10;
				}
				return "";
			});
		}
		
		function AddChannel(name, config) {
			var ident = "channel_" + $("#channels").children().length;
			
			var newHTML = "<li id='{0}' class='ui-state-default channel'>" +
				"<table><tr><td class='move'><span class='ui-icon ui-icon-arrowthick-2-n-s'></span></td>" +
				"<td class='nameContainer'><input class='channelName' value='{1}' /></td>" +
				"<td class='edit'><span class='ui-icon ui-icon-pencil' onclick=\"$('#editor_{0}').removeAttr('disabled');\"></span></td>" +
				"<td class='configContainer'><input id='editor_{0}' class='channelConfig' value='{2}' disabled='true' /></td>" +
				"<td class='trash'><span class='ui-icon ui-icon-trash' onclick='$(\"#{0}\").remove();'></span></td></tr></table></li>";
			$("#channels").append(sformat(newHTML, ident, name, config));
		}
		
        function AddStation() {
            if (!newSet.value && !newOrder.value) { alert("Please specify sort order"); return; }
            if (newSet.value && !newValues.value) { alert("Please specify criteria"); return; }
            if (!newName.value) { alert("Please pick a name for this station"); return; }
            if (newValues.value && newValues.value.indexOf(' ') > -1) { alert("Criteria may not contain spaces.\nSeparate them by placing one on each row..."); return; }
			if (newSet.value == "user" && newValues.value.indexOf("\n") > -1 ) { alert("You may only fetch albums from a single user."); return; }
			var config = "";
						
			switch (newSet.value) {
				case "tag":
					config = "+album_tag/?tag_idstr=" + newValues.value.replace(/\n/mg, '+');
					if(newOrder.value) config += "&order=" + newOrder.value;
					break;
				case "artist":
					config = "/?order=random&artist_idstr=" + newValues.value.replace(/\n/mg, '+');
					break;
				case "album":
					config = "/?order=random&album_id=" + newValues.value.replace(/\n/mg, '+');
					break;
				case "playlist":
					config = "+playlist_track/?order=random&playlist_id=" + newValues.value.replace(/\n/mg, '+');
					break;
				case "jamradio":
					config = "+radio_track_inradioplaylist/?order=random&radio_id=" + newValues.value.replace(/\n/mg, '+');
					break;
				case "user":
					config = "+album_user_starred/?order=random&user_idstr=" + newValues.value.replace(/\n/mg, '+');
					break;
				default:
					config = "/?order=" + newOrder.value;
			}
			
            AddChannel(newName.value, config);

            designer.className = 'hidden';
        }
		
		$(function() {
			$("#accordion").accordion({ fillSpace: true });
			$("#channels").sortable();
			$("#channels").disableSelection();
		});
	</script>
    <style type="text/css">
		@import url(Theme/ui-darkness/jquery-ui-1.7.2.custom.css);
		body { overflow:hidden }
		ul				{ list-style-type:none; min-width:700px;}
		.channel		{ white-space:nowrap; } .channel input { width:100%; }
		.channel table  { width:100%;}
		.nameContainer	{ width:250px; }
		.channelConfig  { width:100%; }
		.move, .edit
		{ width:30px; }
		.trash span, .edit span		
		{ float:right; }
		.nameTitle		{ margin:0 250px 0 50px; } .configTitle { width:65%; }
        .hidden
        {
            display: none;
        }
    </style>
</head>
<body onload="restore_options()">
	<table style="height:100%;width:100%;"><tr><td><div id="accordion">

	<h3><a href="#">Jamendo Radio</a></h3>
	<div>
		<p>
			<input type="checkbox" id="pageIntegration" style="width: 75px;" />Integrate with jamendo.com<br />
			<input type="checkbox" id="skipDefault" style="width: 75px;" />Don't add the "Default" channel.<br />
		</p>
	</div>
	<h3><a href="#">Channels</a></h3>
	<div>
		<p>
			<span class="nameTitle">Name</span>
			<span class="configTitle">Configuration string</span>
		</p>
		<ul id="channels">
		</ul>
	</div>
	<h3><a href="#">Channel designer</a></h3>
    <div id="designer">
		<h2 style="margin:0;">Channel Designer</h2>
        <dl>
            <dt>Name</dt>
            <dd>
                <input id="newName" /></dd>
            <dt>Selection</dt>
            <dd>
                <select id="newSet" onchange="newValues.disabled = this.selectedIndex == 0; newOrder.disabled = this.selectedIndex > 1;">
                    <option value="">Everyting</option>
                    <option value="tag">Tag(s)</option>
                    <option value="artist">Artist(s)</option>
                    <option value="album">Album(s)</option>
					<option value="playlist">Playlist(s)</option>
					<option value="jamradio">JamRadio(s)</option>
					<option value="user">User starred albums</option>
                </select>
            </dd>
            <dt>Criteria</dt>
            <dd>
                <textarea id="newValues" rows="6" cols="25" disabled="disabled" onblur="this.value = this.value.replace(/\n+/, '\n').replace(/\n*$/, '');"></textarea></dd>
            <dt>Sorting</dt>
            <dd>
                <select id="newOrder">
                    <option value="">No sorting</option>
                    <option value="releasedate_desc">Release date</option>
                    <option value="rating_desc">Rating</option>
                    <option value="ratingweek_desc">Rating (weekly)</option>
                    <option value="ratingmonth_desc">Rating (monthy)</option>
                    <option value="playlisted_desc">Playlisted</option>
                    <option value="downloaded_desc">Downloaded</option>
                    <option value="listened_desc">Listened</option>
                    <option value="starred_desc">Favourited</option>
                </select>
            </dd>
        </dl>
        <div style="text-align: center;">
            <button id="clearDesigner" onclick="newName.value = newSet.value = newValues.value = newOrder.value = '';newValues.disabled = true">
                Clear</button>
            <button onclick="AddStation();">
                Add channel</button>
            <button onclick="designer.className='hidden'">
                Cancel</button>
        </div>
    </div>
</div>
</td></tr><tr style="height:30px"><td>
<div class="ui-state-error ui-corner-all" style="margin-bottom:14px;"><p><span class='ui-icon ui-icon-alert'></span><strong>Oh no!</strong></p></div></td></tr></table>
</body>
</html>
